{% extends "layout.html" %}
{% block title %}Login{% endblock %}
{% block page %}Login{% endblock %}
{% block head %}
{{ super() }}
<style type="text/css">
  
    .moveme {
  display: table;
  margin-right: auto;
  margin-left: auto;
  background-color:#F5F5F5;
  padding: 40px;
  max-width:600px;
  margin:40px auto;
  }

  input[name=email] {
	background-color: #F8F8F8;
	width: 70%;
	padding: 12px 20px;
	margin: 8px 0;
	box-sizing: border-box;
	border: 2px solid black;
	border-radius: 4px;
	}
	
	
	
	input[name=password] {
	background-color: #F8F8F8;
	width: 70%;
	padding: 12px 20px;
	margin: 8px 0;
	box-sizing: border-box;
	border: 2px solid black;
	border-radius: 4px;
	align:center;
	}
	
	input[name=button], input[type=submit], input[id=submit] {
	background-color: rgb(0, 225, 255);
	border: none;
	color: white;
	padding: 16px 32px;
	text-decoration: none;
	margin: 4px 2px;
	cursor: pointer;
	width: 100%;
	}

</style>
{% endblock %}

{% block content %}

    <div class="moveme">
      <h1 class="teal lighten-3">Grocery Hunters</h1>
      <img src= "static/shopping-cart.png">
    <div class="row">
    <form id="myForm" class="col s12">
      <div class="row" >
        <div class="input-field col s12">
          <input name="email" id="email" required type="email" placeholder="Enter Email" class="validate">
          <label for="email">Email</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s12">
          <input name="password" id="password" required type="password" placeholder="Enter Password" class="validate">
          <label for="password">Password</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s12">
          <input name="submit" id="submit" type="submit" class="btn waves-effect waves-light">
        </div>
        <div class="input-field col s12">
          <a id="sign up" class="btn waves-effect waves-light" href="signup">Sign Up</a>
        </div>
      </div>
    </form>
  </div>
  </div>
  <script>
    async function postData(url, data){
      try{
        let response = await fetch(
          url, 
          {
            method: 'POST',
            body: JSON.stringify(data),//convert data to JSON string
            headers: { 'Content-Type':'application/json' }// JSON data
          },
        );//1. Send http request and get response
        
        let result = await response.text();//2. Get message from response 
        if(result=="Success"){
          sessionStorage.setItem('email', data.email);
          window.location.href="/main";
        }
        else
          alert(result);//3. Do something with the message 
      }catch(error){
        console.log(error);//catch and log any errors
      }
}
    function submit(event){
      event.preventDefault();//prevents page redirection
     
      //event target returns the element on which the event is fired upon ie event.target === myForm

      const form = event.target;
      const formData = new FormData(form);//get form data
      const data = Object.fromEntries(formData);//convert form data to object

      postData('/signin', data);
    }

    //attach the submit function to the submit event of myForm    
    document.forms['myForm'].addEventListener('submit', submit);
  </script>
{% endblock %}